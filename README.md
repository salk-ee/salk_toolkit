# salk_toolkit

Salk Toolkit bundles the internal utilities we use to read annotated survey data, transform it into plotting-friendly structures, and wire everything up to Streamlit dashboards. The package now ships as a regular Python library—no nbdev export step required.

## Highlights

- **Data annotations** – `salk_toolkit.io.read_and_process_data` ingests JSON/Parquet files with inline metadata (see `tests/test_io.py` for fixtures).
- **Plot pipeline** – `salk_toolkit.pp.e2e_plot` turns annotated frames into Altair charts registered in `salk_toolkit/plots.py`.
- **Dashboards** – `salk_toolkit.dashboard.SalkDashboardBuilder` adds authentication, translation and plotting glue for Streamlit apps.
- **CLI tools** – `stk_explorer` opens the built-in explorer, `stk_translate_dashboard` automates Deepl-backed translation flows.

## Installation

```sh
pip install salk_toolkit
```

For local development, install in editable mode and pull the dev extras:

```sh
pip install -e .[dev]
```

## Quick start

```python
from pathlib import Path
from salk_toolkit.io import read_and_process_data
from salk_toolkit.pp import e2e_plot

data_file = Path("tests/data/master_meta.json")
df, meta = read_and_process_data(data_file)

plot_desc = {
    "plot": "likert_bars",
    "res_col": "question_value",
    "factor_cols": ["question"],
    "pp_filter": {},
}

chart = e2e_plot(plot_desc, df=df, data_meta=meta)
chart.show()
```

## Documentation

All public modules now contain the markdown context that previously lived in notebooks. Regenerate API docs with [pdoc](https://pdoc.dev):

```sh
make docs  # generates docs_html/
```

The HTML output is ignored by git and meant as a local/CI artifact.

## CLI tools

After installation the following entry points are available:

| Command | Description |
| ------- | ----------- |
| `stk_explorer` | Launch the Streamlit explorer app defined in `salk_toolkit/tools/explorer.py`. |
| `stk_translate_dashboard` | Translate a dashboard directory using Deepl (see `salk_toolkit.commands`). |

## Contributing

- Edit the modules under `salk_toolkit/` directly—there are no autogenerated `.py` files anymore.
- Keep markdown-style docstrings/comments up to date when adding new helpers.
- Run `python -m pytest` (or `pre-commit run --all-files`) before sending changes.
- Regenerate docs via `make docs` if signatures or docstrings changed.
